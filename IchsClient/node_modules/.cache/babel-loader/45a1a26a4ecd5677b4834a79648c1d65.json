{"ast":null,"code":"'use client';\n\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _objectWithoutPropertiesLoose from \"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose\";\nimport _isFunction from \"lodash/isFunction\";\nimport _isNil from \"lodash/isNil\";\nimport _omit from \"lodash/omit\";\nimport _pick from \"lodash/pick\";\nvar _excluded = [\"as\", \"appearance\", \"classPrefix\", \"cleanable\", \"childrenKey\", \"data\", \"disabled\", \"defaultValue\", \"defaultExpandAll\", \"disabledItemValues\", \"defaultExpandItemValues\", \"expandItemValues\", \"id\", \"locale\", \"labelKey\", \"placeholder\", \"placement\", \"style\", \"searchKeyword\", \"searchable\", \"showIndentLine\", \"menuClassName\", \"menuStyle\", \"popupClassName\", \"popupStyle\", \"popupAutoWidth\", \"treeHeight\", \"menuAutoWidth\", \"valueKey\", \"virtualized\", \"value\", \"listProps\", \"toggleAs\", \"searchBy\", \"getChildren\", \"onClean\", \"onSearch\", \"onSelect\", \"onSelectItem\", \"onChange\", \"onExpand\", \"onEnter\", \"onExit\", \"onEntered\", \"renderValue\", \"renderMenu\", \"renderTree\", \"renderTreeIcon\", \"renderTreeNode\", \"renderExtraFooter\"];\nimport React, { useMemo } from 'react';\nimport { useClassNames, useCustom, useControlled, useEventCallback } from \"../internals/hooks/index.js\";\nimport { createChainedFunction, mergeRefs } from \"../internals/utils/index.js\";\nimport { getActiveItem, getTreeActiveNode } from \"../Tree/utils/index.js\";\nimport { PickerToggle, PickerPopup, PickerToggleTrigger, usePickerClassName, usePickerRef, onMenuKeyDown, pickTriggerPropKeys, omitTriggerPropKeys, useToggleKeyDownEvent } from \"../internals/Picker/index.js\";\nimport { TreeProvider, useTreeImperativeHandle } from \"../internals/Tree/TreeProvider.js\";\nimport useTreeWithChildren from \"../Tree/hooks/useTreeWithChildren.js\";\nimport useFlattenTree from \"../Tree/hooks/useFlattenTree.js\";\nimport useFocusState from \"./hooks/useFocusState.js\";\nimport useExpandTree from \"../Tree/hooks/useExpandTree.js\";\nimport TreeView from \"../Tree/TreeView.js\";\n/**\n * The `TreePicker` component is used for selecting single options which are organized in a tree structure.\n *\n * @see https://rsuitejs.com/components/tree-picker/\n */\nvar TreePicker = /*#__PURE__*/React.forwardRef(function (props, ref) {\n  var _props$as = props.as,\n    Component = _props$as === void 0 ? 'div' : _props$as,\n    _props$appearance = props.appearance,\n    appearance = _props$appearance === void 0 ? 'default' : _props$appearance,\n    _props$classPrefix = props.classPrefix,\n    classPrefix = _props$classPrefix === void 0 ? 'picker' : _props$classPrefix,\n    _props$cleanable = props.cleanable,\n    cleanable = _props$cleanable === void 0 ? true : _props$cleanable,\n    _props$childrenKey = props.childrenKey,\n    childrenKey = _props$childrenKey === void 0 ? 'children' : _props$childrenKey,\n    _props$data = props.data,\n    data = _props$data === void 0 ? [] : _props$data,\n    disabled = props.disabled,\n    defaultValue = props.defaultValue,\n    _props$defaultExpandA = props.defaultExpandAll,\n    defaultExpandAll = _props$defaultExpandA === void 0 ? false : _props$defaultExpandA,\n    _props$disabledItemVa = props.disabledItemValues,\n    disabledItemValues = _props$disabledItemVa === void 0 ? [] : _props$disabledItemVa,\n    _props$defaultExpandI = props.defaultExpandItemValues,\n    defaultExpandItemValues = _props$defaultExpandI === void 0 ? [] : _props$defaultExpandI,\n    controlledExpandItemValues = props.expandItemValues,\n    id = props.id,\n    overrideLocale = props.locale,\n    _props$labelKey = props.labelKey,\n    labelKey = _props$labelKey === void 0 ? 'label' : _props$labelKey,\n    placeholder = props.placeholder,\n    _props$placement = props.placement,\n    placement = _props$placement === void 0 ? 'bottomStart' : _props$placement,\n    style = props.style,\n    searchKeyword = props.searchKeyword,\n    _props$searchable = props.searchable,\n    searchable = _props$searchable === void 0 ? true : _props$searchable,\n    showIndentLine = props.showIndentLine,\n    DEPRECATED_menuClassName = props.menuClassName,\n    DEPRECATED_menuStyle = props.menuStyle,\n    popupClassName = props.popupClassName,\n    popupStyle = props.popupStyle,\n    _props$popupAutoWidth = props.popupAutoWidth,\n    popupAutoWidth = _props$popupAutoWidth === void 0 ? true : _props$popupAutoWidth,\n    _props$treeHeight = props.treeHeight,\n    treeHeight = _props$treeHeight === void 0 ? 320 : _props$treeHeight,\n    _props$menuAutoWidth = props.menuAutoWidth,\n    menuAutoWidth = _props$menuAutoWidth === void 0 ? popupAutoWidth : _props$menuAutoWidth,\n    _props$valueKey = props.valueKey,\n    valueKey = _props$valueKey === void 0 ? 'value' : _props$valueKey,\n    _props$virtualized = props.virtualized,\n    virtualized = _props$virtualized === void 0 ? false : _props$virtualized,\n    controlledValue = props.value,\n    listProps = props.listProps,\n    toggleAs = props.toggleAs,\n    searchBy = props.searchBy,\n    getChildren = props.getChildren,\n    onClean = props.onClean,\n    onSearch = props.onSearch,\n    onSelect = props.onSelect,\n    onSelectItem = props.onSelectItem,\n    onChange = props.onChange,\n    onExpand = props.onExpand,\n    onEnter = props.onEnter,\n    onExit = props.onExit,\n    onEntered = props.onEntered,\n    renderValue = props.renderValue,\n    DEPRECATED_renderMenu = props.renderMenu,\n    _props$renderTree = props.renderTree,\n    renderTree = _props$renderTree === void 0 ? DEPRECATED_renderMenu : _props$renderTree,\n    renderTreeIcon = props.renderTreeIcon,\n    renderTreeNode = props.renderTreeNode,\n    renderExtraFooter = props.renderExtraFooter,\n    rest = _objectWithoutPropertiesLoose(props, _excluded);\n  var _useCustom = useCustom('Picker', overrideLocale),\n    locale = _useCustom.locale;\n  var _usePickerRef = usePickerRef(ref),\n    trigger = _usePickerRef.trigger,\n    root = _usePickerRef.root,\n    target = _usePickerRef.target,\n    overlay = _usePickerRef.overlay,\n    list = _usePickerRef.list,\n    searchInput = _usePickerRef.searchInput,\n    treeView = _usePickerRef.treeView;\n  var _useControlled = useControlled(controlledValue, defaultValue),\n    value = _useControlled[0],\n    setValue = _useControlled[1];\n  var itemDataKeys = {\n    childrenKey: childrenKey,\n    labelKey: labelKey,\n    valueKey: valueKey\n  };\n  var _useTreeWithChildren = useTreeWithChildren(data, itemDataKeys),\n    treeData = _useTreeWithChildren.treeData,\n    loadingNodeValues = _useTreeWithChildren.loadingNodeValues,\n    appendChild = _useTreeWithChildren.appendChild;\n  var flattenedNodes = useFlattenTree(treeData, _extends({}, itemDataKeys));\n  var _useExpandTree = useExpandTree(data, _extends({}, itemDataKeys, {\n      defaultExpandAll: defaultExpandAll,\n      defaultExpandItemValues: defaultExpandItemValues,\n      controlledExpandItemValues: controlledExpandItemValues,\n      onExpand: onExpand,\n      getChildren: getChildren,\n      appendChild: appendChild\n    })),\n    expandItemValues = _useExpandTree.expandItemValues,\n    handleExpandTreeNode = _useExpandTree.handleExpandTreeNode;\n  var _useClassNames = useClassNames(classPrefix),\n    prefix = _useClassNames.prefix,\n    merge = _useClassNames.merge;\n  var activeNode = getTreeActiveNode(flattenedNodes, value, valueKey);\n  var _useTreeImperativeHan = useTreeImperativeHandle(),\n    register = _useTreeImperativeHan.register,\n    focusFirstNode = _useTreeImperativeHan.focusFirstNode,\n    focusActiveNode = _useTreeImperativeHan.focusActiveNode;\n  var _useFocusState = useFocusState({\n      focusActiveNode: focusActiveNode,\n      target: target,\n      value: value,\n      onEnter: onEnter,\n      onExit: onExit,\n      onEntered: onEntered\n    }),\n    active = _useFocusState.active,\n    focusItemValue = _useFocusState.focusItemValue,\n    setFocusItemValue = _useFocusState.setFocusItemValue,\n    triggerProps = _useFocusState.triggerProps;\n  var handleSelect = useEventCallback(function (treeNode, value, event) {\n    var _target$current, _trigger$current, _trigger$current$clos;\n    setFocusItemValue(value);\n    onSelect === null || onSelect === void 0 ? void 0 : onSelect(treeNode, value, event);\n    (_target$current = target.current) === null || _target$current === void 0 ? void 0 : _target$current.focus();\n    (_trigger$current = trigger.current) === null || _trigger$current === void 0 ? void 0 : (_trigger$current$clos = _trigger$current.close) === null || _trigger$current$clos === void 0 ? void 0 : _trigger$current$clos.call(_trigger$current);\n  });\n  var handleClean = useEventCallback(function (event) {\n    var target = event.target;\n    // exclude searchbox\n    if (target.matches('input[role=\"searchbox\"]') || disabled || !cleanable) {\n      return;\n    }\n    setValue(null);\n    onChange === null || onChange === void 0 ? void 0 : onChange(null, event);\n  });\n  var handleTreePressEnter = useEventCallback(function (event) {\n    if (_isNil(focusItemValue)) {\n      return;\n    }\n    var activeItem = getActiveItem(focusItemValue, flattenedNodes, valueKey);\n    handleSelect(activeItem, event);\n  });\n  var handleTreeKeyDown = useEventCallback(function (event) {\n    onMenuKeyDown(event, {\n      del: handleClean,\n      down: function down() {\n        return focusFirstNode();\n      },\n      enter: handleTreePressEnter\n    });\n  });\n  var onPickerKeydown = useToggleKeyDownEvent(_extends({\n    toggle: !activeNode || !active,\n    trigger: trigger,\n    target: target,\n    overlay: overlay,\n    searchInput: searchInput,\n    active: active,\n    onExit: handleClean,\n    onMenuKeyDown: handleTreeKeyDown\n  }, rest));\n  var handleChange = useEventCallback(function (nextValue, event) {\n    setValue(nextValue);\n    onChange === null || onChange === void 0 ? void 0 : onChange(nextValue, event);\n  });\n  var treeContext = useMemo(function () {\n    return {\n      register: register,\n      props: {\n        labelKey: labelKey,\n        valueKey: valueKey,\n        childrenKey: childrenKey,\n        virtualized: virtualized,\n        renderTreeIcon: renderTreeIcon,\n        renderTreeNode: renderTreeNode\n      }\n    };\n  }, [childrenKey, labelKey, valueKey, virtualized, register, renderTreeIcon, renderTreeNode]);\n  var tree = /*#__PURE__*/React.createElement(TreeProvider, {\n    value: treeContext\n  }, /*#__PURE__*/React.createElement(TreeView, {\n    ref: treeView,\n    value: value,\n    data: treeData,\n    disabledItemValues: disabledItemValues,\n    expandItemValues: expandItemValues,\n    showIndentLine: showIndentLine,\n    searchable: searchable,\n    searchKeyword: searchKeyword,\n    searchBy: searchBy,\n    loadingNodeValues: loadingNodeValues,\n    flattenedNodes: flattenedNodes,\n    listProps: listProps,\n    listRef: list,\n    height: treeHeight,\n    onExpand: handleExpandTreeNode,\n    onSearch: onSearch,\n    onChange: handleChange,\n    onSelect: handleSelect,\n    onSelectItem: onSelectItem,\n    onFocusItem: setFocusItemValue\n  }));\n  var renderTreeView = function renderTreeView(positionProps, speakerRef) {\n    var left = positionProps.left,\n      top = positionProps.top,\n      className = positionProps.className;\n    var classes = merge(className, DEPRECATED_menuClassName, popupClassName, prefix('tree-menu'));\n    var mergedMenuStyle = _extends({}, DEPRECATED_menuStyle, popupStyle, {\n      left: left,\n      top: top\n    });\n    return /*#__PURE__*/React.createElement(PickerPopup, {\n      autoWidth: menuAutoWidth,\n      className: classes,\n      style: mergedMenuStyle,\n      ref: mergeRefs(overlay, speakerRef),\n      onKeyDown: onPickerKeydown,\n      target: trigger\n    }, renderTree ? renderTree(tree) : tree, renderExtraFooter === null || renderExtraFooter === void 0 ? void 0 : renderExtraFooter());\n  };\n\n  /**\n   * 1.Have a value and the value is valid.\n   * 2.Regardless of whether the value is valid, as long as renderValue is set, it is judged to have a value.\n   */\n  var hasValidValue = !_isNil(activeNode) || !_isNil(value) && _isFunction(renderValue);\n  var selectedElement = placeholder;\n  if (hasValidValue) {\n    var node = activeNode !== null && activeNode !== void 0 ? activeNode : {};\n    selectedElement = node[labelKey];\n    if (_isFunction(renderValue) && value) {\n      selectedElement = renderValue(value, node, selectedElement);\n      if (_isNil(selectedElement)) {\n        hasValidValue = false;\n      }\n    }\n  }\n  var _usePickerClassName = usePickerClassName(_extends({}, props, {\n      classPrefix: classPrefix,\n      appearance: appearance,\n      hasValue: hasValidValue,\n      name: 'tree',\n      cleanable: cleanable\n    })),\n    classes = _usePickerClassName[0],\n    usedClassNamePropKeys = _usePickerClassName[1];\n  return /*#__PURE__*/React.createElement(PickerToggleTrigger, _extends({\n    id: id,\n    popupType: \"tree\",\n    pickerProps: _pick(props, pickTriggerPropKeys),\n    ref: trigger,\n    placement: placement,\n    speaker: renderTreeView\n  }, triggerProps), /*#__PURE__*/React.createElement(Component, {\n    className: classes,\n    style: style,\n    ref: root\n  }, /*#__PURE__*/React.createElement(PickerToggle, _extends({}, _omit(rest, [].concat(omitTriggerPropKeys, usedClassNamePropKeys, ['cascade'])), {\n    ref: target,\n    appearance: appearance,\n    onKeyDown: onPickerKeydown,\n    onClean: createChainedFunction(handleClean, onClean),\n    cleanable: cleanable && !disabled,\n    as: toggleAs,\n    disabled: disabled,\n    hasValue: hasValidValue,\n    active: active,\n    placement: placement,\n    inputValue: value,\n    focusItemValue: focusItemValue\n  }), selectedElement || locale.placeholder)));\n});\nTreePicker.displayName = 'TreePicker';\nexport default TreePicker;","map":null,"metadata":{},"sourceType":"module"}